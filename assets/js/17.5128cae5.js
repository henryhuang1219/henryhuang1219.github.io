(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{561:function(t,a,s){"use strict";s.r(a);var n=s(12),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"title"}),s("p",[t._v("Ktor 框架工具推薦及簡介。")])]),t._v(" "),s("h2",{attrs:{id:"engine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#engine"}},[t._v("#")]),t._v(" Engine")]),t._v(" "),s("p",[t._v("可以通過兩種方式創建和運行 Ktor 服務器應用程序：使用 "),s("a",{attrs:{href:"https://ktor.io/docs/engines.html#embeddedServer",target:"_blank",rel:"noopener noreferrer"}},[t._v("EmbeddedServer"),s("OutboundLink")],1),t._v(" 在代碼中設置參數，或使用 "),s("a",{attrs:{href:"https://ktor.io/docs/engines.html#EngineMain",target:"_blank",rel:"noopener noreferrer"}},[t._v("EngineMain"),s("OutboundLink")],1),t._v(" 從外部"),s("code",[t._v("application.conf")]),t._v("文件加載配置。")]),t._v(" "),s("p",[t._v("將敏感資訊和程式碼分開，是一個資安上要特別注意的地方，這裡推薦使用 EngineMain，並將配置加進"),s("code",[t._v("PROJECT/src/main/resources/application.conf")]),t._v("("),s("a",{attrs:{href:"https://github.com/lightbend/config/blob/master/HOCON.md#hocon-human-optimized-config-object-notation",target:"_blank",rel:"noopener noreferrer"}},[t._v("HOCON"),s("OutboundLink")],1),t._v(")中。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('ktor {\n    deployment {\n        port = 8080\n        port = ${?PORT}\n    }\n    application {\n        modules = [ me.lazy_assedninja.application.ApplicationKt.module ]\n    }\n    database {\n        user = "lazy-assedninja"\n        password = "000000"\n    }\n}\n')])])]),s("h2",{attrs:{id:"routing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#routing"}},[t._v("#")]),t._v(" Routing")]),t._v(" "),s("p",[t._v("Routing 是用於處理 Server 接到的請求。")]),t._v(" "),s("p",[t._v("最基本的使用方式如下：")]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[t._v("routing "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/hello"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("還有提供類似群組的功能：")]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[t._v("routing "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("route")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("post")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"login"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"orm-框架"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#orm-框架"}},[t._v("#")]),t._v(" ORM 框架")]),t._v(" "),s("p",[t._v("Exposed 是一個 Kotlin 的 ORM framework，可以透過 Exposed 在 Ktor 中串接資料庫。")]),t._v(" "),s("p",[t._v("這時就可以將資料庫配置從 "),s("a",{attrs:{href:"#engine"}},[t._v("Engine")]),t._v(" 提到的"),s("code",[t._v("application.conf")]),t._v("中取出，設置資料庫。")]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" environment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ktor.database.user"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" password "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" environment"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ktor.database.password"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nDatabase"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("connect")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jdbc:h2:mem:test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" driver "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"org.h2.Driver"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" user"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" password "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" password"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nrouting "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// ... ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"dsl-dao"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dsl-dao"}},[t._v("#")]),t._v(" DSL & DAO")]),t._v(" "),s("p",[t._v("Exposed 提供2種 API 分別是 "),s("a",{attrs:{href:"https://github.com/JetBrains/Exposed/wiki/DSL",target:"_blank",rel:"noopener noreferrer"}},[t._v("DSL(Domain Specific Language)"),s("OutboundLink")],1),t._v(" 和 "),s("a",{attrs:{href:"https://github.com/JetBrains/Exposed/wiki/DAO",target:"_blank",rel:"noopener noreferrer"}},[t._v("DAO(Data Access Object)"),s("OutboundLink")],1),t._v("。\nDSL 類似 Kotlin 所提供具有類型安全性的 SQL 語法，而 DAO 則與帶有 Kotlin 特定 API 的 ORM 框架較為相似， 可針對需求來選擇合適的 API。\n這裡選擇使用 DSL 來開發，避免一張表分別需要建立 Table、Entity 和 DTO，如果表的數量增多，Class 數量將會成倍數成長；如果表的數量不多，便可考慮使用 DAO，享受方便快速的編程體驗。")]),t._v(" "),s("h2",{attrs:{id:"序列化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#序列化"}},[t._v("#")]),t._v(" 序列化")]),t._v(" "),s("p",[t._v("Ktor提供幾種序列化的方式"),s("code",[t._v("kotlinx.serialization")]),t._v("、"),s("code",[t._v("Gson")]),t._v("和"),s("code",[t._v("Jackson")]),t._v("，可針對使用需求來選擇合適的轉換器，這裡推薦使用"),s("code",[t._v("kotlinx.serialization")]),t._v("。\n支援最多種格式之外，只需在 Class 加上 "),s("code",[t._v("@Serializable")]),t._v("，便完成轉換所需配置。")]),t._v(" "),s("div",{staticClass:"language-kotlin extra-class"},[s("pre",{pre:!0,attrs:{class:"language-kotlin"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation builtin"}},[t._v("@Serializable")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("data")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Customer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" firstName"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("val")]),t._v(" lastName"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"title"}),s("p",[t._v("使用前須在"),s("code",[t._v("build.gradle")]),t._v("設置 plugins 和 dependencies 外，還需要註冊 json converter。")])]),s("h2",{attrs:{id:"參考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#參考"}},[t._v("#")]),t._v(" 參考")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://ktor.io/docs/serialization.html#receive_data",target:"_blank",rel:"noopener noreferrer"}},[t._v("Content negotiation and serialization"),s("OutboundLink")],1),s("br"),t._v(" "),s("a",{attrs:{href:"https://ithelp.ithome.com.tw/users/20120550/ironman/2950",target:"_blank",rel:"noopener noreferrer"}},[t._v("最好用的非同步網頁框架！開始用 Ktor 寫 Kotlin Server"),s("OutboundLink")],1),s("br")])])}),[],!1,null,null,null);a.default=e.exports}}]);